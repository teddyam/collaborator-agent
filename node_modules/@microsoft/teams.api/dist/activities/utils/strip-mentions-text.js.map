{"version":3,"sources":["../../../src/activities/utils/strip-mentions-text.ts"],"names":[],"mappings":";;AA4BO,SAAS,kBACd,QACA,EAAA,EAAE,WAAW,OAAQ,EAAA,GAA8B,EAChC,EAAA;AACnB,EAAI,IAAA,CAAC,SAAS,IAAM,EAAA;AAEpB,EAAA,IAAI,OAAO,QAAS,CAAA,IAAA;AAEpB,EAAW,KAAA,MAAA,OAAA,IAAW,QAAS,CAAA,QAAA,EAAU,MAAO,CAAA,CAAC,CAAM,KAAA,CAAA,CAAE,IAAS,KAAA,SAAS,CAAK,IAAA,EAAI,EAAA;AAClF,IAAA,IAAI,SAAa,IAAA,OAAA,CAAQ,SAAU,CAAA,EAAA,KAAO,SAAW,EAAA;AACnD,MAAA;AAAA;AAGF,IAAA,IAAI,QAAQ,IAAM,EAAA;AAChB,MAAM,MAAA,eAAA,GAAkB,QAAQ,IAAK,CAAA,OAAA,CAAQ,QAAQ,EAAE,CAAA,CAAE,OAAQ,CAAA,OAAA,EAAS,EAAE,CAAA;AAC5E,MAAA,IAAA,GAAO,KAAK,OAAQ,CAAA,OAAA,CAAQ,MAAM,CAAC,OAAA,GAAU,KAAK,eAAe,CAAA;AAAA,KAC5D,MAAA;AACL,MAAA,IAAA,GAAO,IAAK,CAAA,OAAA;AAAA,QACV,CAAA,IAAA,EAAO,OAAQ,CAAA,SAAA,CAAU,IAAI,CAAA,KAAA,CAAA;AAAA,QAC7B,CAAC,OAAA,GAAU,EAAK,GAAA,OAAA,CAAQ,SAAU,CAAA;AAAA,OACpC;AAAA;AACF;AAGF,EAAA,OAAO,KAAK,IAAK,EAAA;AACnB","file":"strip-mentions-text.js","sourcesContent":["import { IMessageActivity, IMessageUpdateActivity } from '../message';\nimport { ITypingActivity } from '../typing';\n\n/**\n * any activity type that has a `text` property\n */\ntype TextActivity = IMessageActivity | IMessageUpdateActivity | ITypingActivity;\n\nexport type StripMentionsTextOptions = {\n  /**\n   * the account to remove mentions for\n   * by default, all at-mentions listed in `entities` are removed.\n   */\n  accountId?: string;\n\n  /**\n   * when `true`, the inner text of the tag\n   * will not be removed\n   * Eg. input: Hello <at>my-bot</at>! How are you?\n   *     output: Hello my-bot! How are you?\n   */\n  tagOnly?: boolean;\n};\n\n/**\n * remove \"\\<at>...\\</at>\" text from an activity\n * @param activity the activity\n */\nexport function stripMentionsText<TActivity extends TextActivity>(\n  activity: TActivity,\n  { accountId, tagOnly }: StripMentionsTextOptions = {}\n): TActivity['text'] {\n  if (!activity.text) return;\n\n  let text = activity.text;\n\n  for (const mention of activity.entities?.filter((e) => e.type === 'mention') || []) {\n    if (accountId && mention.mentioned.id !== accountId) {\n      continue;\n    }\n\n    if (mention.text) {\n      const textWithoutTags = mention.text.replace('<at>', '').replace('</at>', '');\n      text = text.replace(mention.text, !tagOnly ? '' : textWithoutTags);\n    } else {\n      text = text.replace(\n        `<at>${mention.mentioned.name}</at>`,\n        !tagOnly ? '' : mention.mentioned.name\n      );\n    }\n  }\n\n  return text.trim();\n}\n"]}